<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place Details</title>
    <link rel="stylesheet" href="styles/view_details.css">
</head>
<body>
    <div class="details-container">
        <h1 class="place-name">Name: <span id="placeName">(backend info)</span></h1>
        <div class="rating">
            StarRating: <span id="starRating">(backend info)</span>
        </div>
        <div class="info">
            Address: <span id="address">(backend info)</span><br>
            Toilet Info: <span id="toiletInfo">(backend info)</span><br>
            Comments: <span id="comments">(backend info)</span>
        </div>
        <div class="amend_information">
            <a href="amend_information.html" class="amend-link">정보 수정 제안</a>
        </div>
        <div class="review-section">
            <h2>Reviews</h2>
            <div id="reviews">(backend info)</div>
        </div>
        <div class="review-prompt">
            <p>Leave a periodic visitor review</p>
            <input type="text" id="username" placeholder="Username" />
            <input type="password" id="password" placeholder="Password" />
            <textarea id="reviewText" placeholder="Please leave a review"></textarea>
            <button id="submitReview">Submit Review</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const placeId = urlParams.get('id');

            // 이름이랑 별점 같은 정보 받아오기
            fetch(`/place/show?id=${placeId}`)
                .then(response => response.json())
                .then(place => {
                    document.getElementById('placeName').textContent = place.name;
                    document.getElementById('starRating').textContent = place.starRating;
                    document.getElementById('address').textContent = place.address;
                    document.getElementById('toiletInfo').textContent = place.toiletInfo;
                })
                .catch(error => {
                    console.error('Error:', error);
                });

            // 리뷰 받아오기
            fetch(`/comment/show?id=${placeId}`)
                .then(response => response.json())
                .then(comments => {
                    const commentsContainer = document.getElementById('reviews');
                    comments.forEach(comment => {
                        const commentElement = document.createElement('p');
                        commentElement.textContent = comment.content;
                        commentsContainer.appendChild(commentElement);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });

            // 제출 버튼 클릭
            document.getElementById('submitReview').addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const reviewText = document.getElementById('reviewText').value;
                const commentData = {
                    username,
                    password,
                    placeId,
                    content: reviewText
                };

                console.log('Username:', username);
                console.log('Password:', password);
                console.log('Review:', reviewText);

                // 입력한 리뷰 보내기
                fetch('/comment/enroll', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commentData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(() => {
                    //리뷰 창 업데이트?
                    const commentsContainer = document.getElementById('reviews');
                    const commentElement = document.createElement('p');
                    commentElement.textContent = `Username: ${username}, Comment: ${reviewText}`;
                    commentsContainer.appendChild(commentElement);
                })
                .catch(error => {
                    console.error('Error:', error);
                });

                // 리뷰창 비우기
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('reviewText').value = '';
            });
        });
    </script>
</body>
</html>

